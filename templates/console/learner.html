{% extends 'console/base.html' %}
{% load listing %}

{% block content %}
    <table id="example" class="table table-striped table-bordered" style="width:100%">
        <thead>
            <tr>
                <th>No.</th>
                <th>Name</th>
                <th>Alamat Email</th>
                <th>Tanggal Lahir</th>
                <th>No. Telp</th>
                <th>Nama Perusahaan</th>
                <th>Jabatan Pekerjaan</th>
                <th>Score Tertinggi Sebelum Menonton video</th>
                <th>Score Tertinggi Setelah Menonton Video</th>
                <th>Action</th>
            </tr>
        </thead>
    </table>
{% endblock %}

{% block style %}
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/bs4/dt-1.10.22/b-1.6.5/r-2.2.6/datatables.min.css"/>
{% endblock %}

{% block js %}
    <script src="https://cdn.datatables.net/v/bs4/dt-1.10.22/b-1.6.5/r-2.2.6/datatables.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10.0.2/dist/sweetalert2.all.min.js" defer></script>

    <script type="text/javascript">
        (function() {
            'use strict';

            window.addEventListener('DOMContentLoaded', function() {
                var perPage = '{{ per_page }}';
                var $table = $('#example').DataTable( {
                    dom: 'frtp',
                    bSort: true,
                    ordering: true,
                    stateSave: false,
                    processing: true,
                    serverSide: true,
                    pageLength: +perPage,
                    language: {
                        oPaginate: {
                            sNext: `<svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-chevron-right" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"/>
                            </svg>`,

                            sPrevious: `<svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-chevron-left" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" d="M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"/>
                            </svg>`,

                            sFirst: `<svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-chevron-double-left" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" d="M8.354 1.646a.5.5 0 0 1 0 .708L2.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"/>
                                <path fill-rule="evenodd" d="M12.354 1.646a.5.5 0 0 1 0 .708L6.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"/>
                            </svg>`,

                            sLast: `<svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-chevron-double-right" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" d="M3.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L9.293 8 3.646 2.354a.5.5 0 0 1 0-.708z"/>
                                <path fill-rule="evenodd" d="M7.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L13.293 8 7.646 2.354a.5.5 0 0 1 0-.708z"/>
                            </svg>`
                        }
                    },
                    oLanguage: {
                        sSearch: 'Pencarian'
                    },
                    ajax: {
                        url: API_ENDPOINT + 'person/users/',
                        cache: true,
                        dataFilter: function(data){
                            var json = jQuery.parseJSON( data );
                            
                            json.recordsTotal = json.total;
                            json.recordsFiltered = json.total;
                            json.data = json.results;
                
                            return JSON.stringify( json ); // return JSON string
                        },
                        data: function(data) {
                            data.offset = data.start;
                            data.keyword = data.search?.value;
                            data.sort_column = data.order[0]?.column;
                            data.sort_dir = data.order[0]?.dir;
                        },
                        error: function (xhr, error, code) {
                            
                        }
                    },
                    columns: [
                        {
                            render: function(data, type, row, meta) {
                                return row?.id;
                            },
                        },
                        {
                            render: function(data, type, row, meta) {
                                var profile = row?.profile;
                                var firstName = profile?.first_name;
                                var username = row?.username;
                                var displayName = firstName ? firstName : username;

                                return displayName;
                            }
                        },
                        {
                            render: function(data, type, row, meta) {
                                return row?.email;
                            },
                        },
                        {
                            render: function(data, type, row, meta) {
                                var profile = row?.profile;
                                return profile?.birthdate;
                            }
                        },
                        {
                            render: function(data, type, row, meta) {
                                var account = row?.account;
                                return account?.msisdn;
                            }
                        },
                        {
                            render: function(data, type, row, meta) {
                                var profile = row?.profile;
                                return profile?.company;
                            }
                        },
                        {
                            render: function(data, type, row, meta) {
                                var profile = row?.profile;
                                return profile?.position;
                            }
                        },
                        {
                            render: function(data, type, row, meta) {
                                return row?.survey_score;
                            }
                        },
                        {
                            render: function(data, type, row, meta) {
                                return row?.evaluate_score;
                            }
                        },
                        {
                            render: function(data, type, row, meta) {
                                return `<a href="${row.permalink}" class="btn btn-sm btn-warning">
                                    Detail
                                </a>`;
                            }
                        },
                    ]
                });
            });
        })();
    </script>
{% endblock %}